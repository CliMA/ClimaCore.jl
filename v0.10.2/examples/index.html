<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · ClimaCore.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCore.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../operators/">Operators</a></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../performance_tips/">Performance tips</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../tutorials/introduction/">Introduction to ClimaCore.jl</a></li></ul></li><li class="is-active"><a class="tocitem" href>Examples</a><ul class="internal"><li><a class="tocitem" href="#D-Column-examples"><span>1D Column examples</span></a></li><li><a class="tocitem" href="#D-Cartesian-examples"><span>2D Cartesian examples</span></a></li><li><a class="tocitem" href="#D-Cartesian-examples-2"><span>3D Cartesian examples</span></a></li><li><a class="tocitem" href="#D-Sphere-examples"><span>2D Sphere examples</span></a></li><li><a class="tocitem" href="#D-Sphere-examples-2"><span>3D Sphere examples</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Libraries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../lib/ClimaCoreVTK/">ClimaCoreVTK.jl</a></li><li><a class="tocitem" href="../lib/ClimaCoreTempestRemap/">ClimaCoreTempestRemap.jl</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaCore.jl/blob/master/docs/src/examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="D-Column-examples"><a class="docs-heading-anchor" href="#D-Column-examples">1D Column examples</a><a id="D-Column-examples-1"></a><a class="docs-heading-anchor-permalink" href="#D-Column-examples" title="Permalink"></a></h2><h2 id="D-Cartesian-examples"><a class="docs-heading-anchor" href="#D-Cartesian-examples">2D Cartesian examples</a><a id="D-Cartesian-examples-1"></a><a class="docs-heading-anchor-permalink" href="#D-Cartesian-examples" title="Permalink"></a></h2><h2 id="D-Cartesian-examples-2"><a class="docs-heading-anchor" href="#D-Cartesian-examples-2">3D Cartesian examples</a><a class="docs-heading-anchor-permalink" href="#D-Cartesian-examples-2" title="Permalink"></a></h2><h3 id="Flux-Limiters-advection"><a class="docs-heading-anchor" href="#Flux-Limiters-advection">Flux Limiters advection</a><a id="Flux-Limiters-advection-1"></a><a class="docs-heading-anchor-permalink" href="#Flux-Limiters-advection" title="Permalink"></a></h3><p>The 3D Cartesian advection/transport example in <a href="https://github.com/CliMA/ClimaCore.jl/tree/main/examples/hybrid/box/limiters_advection.jl"><code>examples/hybrid/box/limiters_advection.jl</code></a> demonstrates the application of flux limiters, namely <a href="@ref"><code>quasimonotone_limiter!</code></a>, in a hybrid Cartesian domain. It also demonstrates the usage of the high-order upwinding scheme in the vertical direction, called <a href="@ref"><code>Upwind3rdOrderBiasedProductC2F</code></a>.</p><h4 id="Equations-and-discretizations"><a class="docs-heading-anchor" href="#Equations-and-discretizations">Equations and discretizations</a><a id="Equations-and-discretizations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations-and-discretizations" title="Permalink"></a></h4><h4 id="Mass"><a class="docs-heading-anchor" href="#Mass">Mass</a><a id="Mass-1"></a><a class="docs-heading-anchor-permalink" href="#Mass" title="Permalink"></a></h4><p>Follows the continuity equation</p><p class="math-container">\[\begin{equation}
  \frac{\partial}{\partial t} \rho = - \nabla \cdot(\rho \boldsymbol{u}) .
\label{eq:continuity}
\end{equation}\]</p><p>This is discretized using the following</p><p class="math-container">\[\begin{equation}
  \frac{\partial}{\partial t} \rho \approx - D_h[ \rho (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v))] - D^c_v[I^f(\rho \boldsymbol{u}_h)) + I^f(\rho) \boldsymbol{u}_v)] .
\label{eq:discrete-continuity}
\end{equation}\]</p><h4 id="Tracers"><a class="docs-heading-anchor" href="#Tracers">Tracers</a><a id="Tracers-1"></a><a class="docs-heading-anchor-permalink" href="#Tracers" title="Permalink"></a></h4><p>For the tracer concentration per unit mass <span>$q$</span>, the tracer density (scalar) <span>$\rho q$</span> follows the advection/transport equation</p><p class="math-container">\[\begin{equation}
  \frac{\partial}{\partial t} \rho q = - \nabla \cdot(\rho q \boldsymbol{u})  + g(\rho, q).
\label{eq:tracers}
\end{equation}\]</p><p>This is discretized using the following</p><p class="math-container">\[\begin{equation}
\frac{\partial}{\partial t} \rho q \approx
- D_h[ \rho q (\boldsymbol{u}_h + I^c(\boldsymbol{u}_v))]
- D^c_v\left[I^f(\rho) U^f\left(I^f(\boldsymbol{u}_h) + \boldsymbol{u}_v, \frac{\rho q}{\rho} \right) \right] + g(\rho, q),
\label{eq:discrete-tracers}
\end{equation}\]</p><p>where <span>$g(\rho, q) = - \nu_4 [\nabla^4_h (\rho q)]$</span> represents the horizontal hyperdiffusion operator, with <span>$\nu_4$</span> (measured in m^4/s) the hyperviscosity constant coefficient.</p><p>Currently tracers are only treated explicitly in the time discretization.</p><h4 id="Prognostic-variables"><a class="docs-heading-anchor" href="#Prognostic-variables">Prognostic variables</a><a id="Prognostic-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Prognostic-variables" title="Permalink"></a></h4><ul><li><span>$\rho$</span>: <em>density</em> measured in kg/m³. This is discretized at cell centers.</li><li><span>$\boldsymbol{u}$</span> <em>velocity</em>, a vector measured in m/s. This is discretized via <span>$\boldsymbol{u} = \boldsymbol{u}_h + \boldsymbol{u}_v$</span> where<ul><li><span>$\boldsymbol{u}_h = u_1 \boldsymbol{e}^1 + u_2 \boldsymbol{e}^2$</span> is the projection onto horizontal covariant components (covariance here means with respect to the reference element), stored at cell centers.</li><li><span>$\boldsymbol{u}_v = u_3 \boldsymbol{e}^3$</span> is the projection onto the vertical covariant components, stored at cell faces.</li></ul></li><li><span>$\rho q$</span>: the tracer density scalar, where <span>$q$</span> is the tracer concentration per unit mass, is stored at cell centers.</li></ul><h4 id="Operators"><a class="docs-heading-anchor" href="#Operators">Operators</a><a id="Operators-1"></a><a class="docs-heading-anchor-permalink" href="#Operators" title="Permalink"></a></h4><p>We make use of the following operators</p><h4 id="Reconstructions"><a class="docs-heading-anchor" href="#Reconstructions">Reconstructions</a><a id="Reconstructions-1"></a><a class="docs-heading-anchor-permalink" href="#Reconstructions" title="Permalink"></a></h4><ul><li><span>$I^c$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.InterpolateF2C">face-to-center reconstruction operator</a>, called <code>first_order_If2c</code> in the example code.</li><li><span>$I^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.InterpolateC2F">center-to-face reconstruction operator</a>, called <code>first_order_Ic2f</code> in the example code.<ul><li>Currently this is just the arithmetic mean, but we will need to use a weighted version with stretched vertical grids.</li></ul></li><li><span>$U^f$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Upwind3rdOrderBiasedProductC2F">center-to-face upwind product operator</a>, called <code>third_order_upwind_c2f</code> in the example code<ul><li>This operator is of third-order of accuracy (when used with a constant vertical velocity and some reduced, but still high-order for non constant vertical velocity).</li></ul></li></ul><h4 id="Differentiation-operators"><a class="docs-heading-anchor" href="#Differentiation-operators">Differentiation operators</a><a id="Differentiation-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Differentiation-operators" title="Permalink"></a></h4><ul><li><span>$D_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.WeakDivergence">discrete horizontal weak spectral divergence</a>, called <code>hwdiv</code> in the example code.</li><li><span>$D^c_v$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.DivergenceF2C">face-to-center vertical divergence</a>, called <code>vdivf2c</code> in the example code.<ul><li>This example uses advective fluxes equal to zero at the top and bottom boundaries.</li></ul></li><li><span>$G_h$</span> is the <a href="https://clima.github.io/ClimaCore.jl/stable/operators/#ClimaCore.Operators.Gradient">discrete horizontal spectral gradient</a>, called <code>hgrad</code> in the example code.</li></ul><p>To discretize the hyperdiffusion operator, <span>$g(\rho, q) = - \nu_4 [\nabla^4 (\rho q)]$</span>, in the horizontal direction, we compose the horizontal weak divergence, <span>$D_h$</span>, and the horizontal gradient operator, <span>$G_h$</span>, twice, with an intermediate call to <a href="@ref"><code>weighted_dss!</code></a> between the two compositions, as in <span>$[g_2(\rho, g) \circ DSS(\rho, q) \circ g_1(\rho, q)]$</span>, with:</p><ul><li><span>$g_1(\rho, q) = D_h(G_h(q))$</span></li><li><span>$DSS(\rho, q) = DSS(g_1(\rho q))$</span></li><li><span>$g_2(\rho, q) = -\nu_4 D_h(\rho G_h(\rho q))$</span><ul><li>with <span>$\nu_4$</span> the hyperviscosity coefficient.</li></ul></li></ul><h4 id="Problem-flow-and-set-up"><a class="docs-heading-anchor" href="#Problem-flow-and-set-up">Problem flow and set-up</a><a id="Problem-flow-and-set-up-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-flow-and-set-up" title="Permalink"></a></h4><p>This test case is set up in a Cartesian (box) domain <span>$[-2 \pi, 2 \pi]^2 \times [0, 4 \pi] ~\textrm{m}^3$</span>, doubly periodic in the horizontal direction, but not in the vertical direction.</p><p>The flow was chosen to be a spiral, i.e., so to have a horizontal uniform rotation, and a vertical velocity <span>$\boldsymbol{u}_v \equiv w = 0$</span> at the top and bottom boundaries, and <span>$\boldsymbol{u}_v \equiv w = 1$</span> in the center of the domain. Moreover, the flow is reversed in all directions halfway through the period so that the tracer blobs go back to its initial configuration (using the same speed scaling constant which was derived to account for the distance travelled in all directions in a half period).</p><p class="math-container">\[\begin{align}
    u &amp;= -u_0 (y - c_y) \cos(\pi t / T_f) \nonumber \\
    v &amp;= u_0 (x - c_x) \cos(\pi t / T_f) \nonumber \\
    w &amp;= u_0 \sin(\pi z / z_m) \cos(\pi t / T_f) \nonumber
\label{eq:flow}
\end{align}\]</p><p>where <span>$u_0 = \pi / 2$</span> is the speed scaling factor to have the flow reversed halfway through the period, <span>$\boldsymbol{c} = (c_x, c_y)$</span> is the center of the rotational flow, which coincides with the center of the domain,  <span>$z_m = 4 \pi$</span> is the maximum height of the domain, and <span>$T_f = 2 \pi$</span> is the final simulation time, which coincides with the temporal period to have a full rotation in the horizontal direction.</p><p>This example is set up to run with three possible initial conditions:</p><ul><li><code>cosine_bells</code></li><li><code>gaussian_bells</code></li><li><code>slotted_spheres</code>: a slight modification of the 2D slotted cylinder test case available in the literature (cfr: <a href="../references/#GubaOpt2014">Oksana Guba, Mark Taylor, Amik St-Cyr (2014)</a>).</li></ul><h2 id="D-Sphere-examples"><a class="docs-heading-anchor" href="#D-Sphere-examples">2D Sphere examples</a><a id="D-Sphere-examples-1"></a><a class="docs-heading-anchor-permalink" href="#D-Sphere-examples" title="Permalink"></a></h2><h2 id="D-Sphere-examples-2"><a class="docs-heading-anchor" href="#D-Sphere-examples-2">3D Sphere examples</a><a class="docs-heading-anchor-permalink" href="#D-Sphere-examples-2" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorials/introduction/">« Introduction to ClimaCore.jl</a><a class="docs-footer-nextpage" href="../lib/ClimaCoreVTK/">ClimaCoreVTK.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Friday 6 May 2022 02:50">Friday 6 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
